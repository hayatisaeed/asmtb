<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Form</title>
</head>
<body>
    <h1>Dynamic Form</h1>
    <form method="post">
        <div id="rows">
            <div class="row">
                <label>Subject:</label>
                <select name="subject_0" onchange="activateUnderSubjects(this)">
                    <option value="">Select</option>
                    {% for subject, under_subjects in data.items() %}
                        <option value="{{ subject }}">{{ subject }}</option>
                    {% endfor %}
                </select>

                <label>Under Subject:</label>
                <select name="under_subject_0" disabled>
                    <option value="">Select</option>
                </select>

                <label>Under Under Subject:</label>
                <select name="under_under_subject_0" disabled>
                    <option value="">Select</option>
                </select>

                <label>Number 1:</label>
                <input type="number" name="number1_0" disabled>

                <label>Number 2:</label>
                <input type="number" name="number2_0" disabled>
            </div>
        </div>

        <button type="button" onclick="addRow()">Add Row</button>

        <input type="submit" value="Submit">
    </form>

    <!-- Display submitted data -->
    {% if form_data %}
        <h2>Submitted Data:</h2>
        <pre>{{ form_data | tojson }}</pre>
    {% endif %}

    <script>
        var rowCounter = 1;

        function activateUnderSubjects(selectElement) {
            var underSubjectSelect = selectElement.parentElement.nextElementSibling.querySelector("select[name^='under_subject']");
            underSubjectSelect.innerHTML = '<option value="">Select</option>'; // Clear options
            underSubjectSelect.disabled = true; // Disable under subject select
            var subject = selectElement.value;
            var underSubjects = {{ data | tojson }}[subject];
            for (var key in underSubjects) {
                underSubjectSelect.innerHTML += '<option value="' + key + '">' + key + '</option>';
            }
            if (subject !== '') {
                underSubjectSelect.disabled = false; // Enable under subject select if subject is selected
            }

            // Disable and clear Under Under Subject and number fields
            var underUnderSubjectSelect = underSubjectSelect.parentElement.nextElementSibling.querySelector("select[name^='under_under_subject']");
            underUnderSubjectSelect.innerHTML = '<option value="">Select</option>';
            underUnderSubjectSelect.disabled = true;

            var number1Input = underUnderSubjectSelect.parentElement.nextElementSibling.querySelector("input[name^='number1']");
            var number2Input = number1Input.parentElement.nextElementSibling.querySelector("input[name^='number2']");
            number1Input.value = '';
            number1Input.disabled = true;
            number2Input.value = '';
            number2Input.disabled = true;
        }

        function activateUnderUnderSubjects(selectElement) {
            var underUnderSubjectSelect = selectElement.parentElement.nextElementSibling.querySelector("select[name^='under_under_subject']");
            underUnderSubjectSelect.innerHTML = '<option value="">Select</option>'; // Clear options
            underUnderSubjectSelect.disabled = true; // Disable under under subject select
            var subject = selectElement.parentElement.previousElementSibling.querySelector("select[name^='subject']").value;
            var underSubject = selectElement.value;
            var underUnderSubjects = {{ data | tojson }}[subject][underSubject];
            for (var i = 0; i < underUnderSubjects.length; i++) {
                underUnderSubjectSelect.innerHTML += '<option value="' + underUnderSubjects[i] + '">' + underUnderSubjects[i] + '</option>';
            }
            if (underSubject !== '') {
                underUnderSubjectSelect.disabled = false; // Enable under under subject select if under subject is selected
            }

            // Disable and clear number fields
            var number1Input = underUnderSubjectSelect.parentElement.nextElementSibling.querySelector("input[name^='number1']");
            var number2Input = number1Input.parentElement.nextElementSibling.querySelector("input[name^='number2']");
            number1Input.value = '';
            number1Input.disabled = true;
            number2Input.value = '';
            number2Input.disabled = true;
        }

        function activateNumbers(selectElement) {
            var number1Input = selectElement.parentElement.nextElementSibling.querySelector("input[name^='number1']");
            var number2Input = number1Input.parentElement.nextElementSibling.querySelector("input[name^='number2']");
            number1Input.disabled = true;
            number2Input.disabled = true;

            var subject = selectElement.parentElement.previousElementSibling.previousElementSibling.querySelector("select[name^='subject']").value;
            var underSubject = selectElement.parentElement.previousElementSibling.querySelector("select[name^='under_subject']").value;
            var underUnderSubject = selectElement.value;

            if (subject !== '' && underSubject !== '' && underUnderSubject !== '') {
                number1Input.disabled = false;
                number2Input.disabled = false;
            }
        }

        function addRow() {
            var newRow = document.createElement('div');
            newRow.className = 'row';
            newRow.innerHTML = `
                <label>Subject:</label>
                <select name="subject_${rowCounter}" onchange="activateUnderSubjects(this)">
                    <option value="">Select</option>
                    {% for subject, under_subjects in data.items() %}
                        <option value="{{ subject }}">{{ subject }}</option>
                    {% endfor %}
                </select>

                <label>Under Subject:</label>
                <select name="under_subject_${rowCounter}" disabled onchange="activateUnderUnderSubjects(this)">
                    <option value="">Select</option>
                </select>

                <label>Under Under Subject:</label>
                <select name="under_under_subject_${rowCounter}" disabled onchange="activateNumbers(this)">
                    <option value="">Select</option>
                </select>

                <label>Number 1:</label>
                <input type="number" name="number1_${rowCounter}" disabled>

                <label>Number 2:</label>
                <input type="number" name="number2_${rowCounter}" disabled>
            `;
            document.getElementById('rows').appendChild(newRow);
            rowCounter++;
        }
    </script>



</body>
</html>
